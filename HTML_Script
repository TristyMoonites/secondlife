<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>SL Master TV</title>
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">

<style>
html,body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:black;
    overflow:hidden;
}
iframe, video {
    position:absolute;
    top:0; left:0;
    width:100%;
    height:100%;
    border:0;
    background:black;
}
#debug {
    position:absolute;
    bottom:10px;
    left:10px;
    background:rgba(0,0,0,0.7);
    color:#0f0;
    font-family:monospace;
    font-size:12px;
    padding:6px;
    z-index:9999;
    display:none;
}
</style>
</head>

<body>
<div id="container"></div>
<div id="debug"></div>

<script>
const p = new URLSearchParams(window.location.search);
const mediaURL = p.get("url");
const startTime = parseInt(p.get("start"));
const serverTime = parseInt(p.get("server"));
const debugOn = p.get("debug") === "1";

const debug = document.getElementById("debug");
if (debugOn) debug.style.display = "block";

function log(msg) {
    if (debugOn) debug.innerHTML += msg + "<br>";
}

function isYT(u){
    return u.includes("youtube") || u.includes("youtu.be");
}

const now = Math.floor(Date.now() / 1000);
const offset = Math.max(0, now - serverTime);

log("Media URL: " + mediaURL);
log("Offset: " + offset + "s");

const c = document.getElementById("container");

if (isYT(mediaURL)) {

    let embed = mediaURL;

    if (embed.includes("watch?v="))
        embed = "https://www.youtube.com/embed/" + embed.split("watch?v=")[1].split("&")[0];

    if (embed.includes("youtu.be/"))
        embed = "https://www.youtube.com/embed/" + embed.split("youtu.be/")[1];

    embed += "?autoplay=1&controls=1&rel=0&start=" + offset;

    const iframe = document.createElement("iframe");
    iframe.src = embed;
    iframe.allow = "autoplay; fullscreen";
    c.appendChild(iframe);

    log("YouTube embed loaded");

} else {

    const v = document.createElement("video");
    v.src = mediaURL;
    v.autoplay = true;
    v.controls = true;

    v.addEventListener("loadedmetadata", ()=>{
        v.currentTime = offset;
        v.play().catch(()=>{});
        log("MP4 started @ " + offset);
    });

    c.appendChild(v);
}
</script>
</body>
</html>
